#!/usr/bin/env ruby

lib = File.expand_path File.join(File.dirname(__FILE__), '../lib')
$LOAD_PATH.unshift(lib)

require 'mdocker'

mdocker_command = ARGV.size > 0 ? ARGV[0] : 'run'
begin
  case mdocker_command
    when 'config'
      project = MDocker::ProjectFactory.new.create({})
      puts project.config.to_s
    when 'run'
      user_command = ARGV.drop(1)
      project = MDocker::ProjectFactory.new.create({command: user_command})
      exit project.run
    else
      STDERR.puts "mdocker: unknown command '#{mdocker_command}'"
      exit 1
  end
rescue Exception => e
  STDERR.puts 'mdocker: ' + e.message
  exit 1
end

exit 0